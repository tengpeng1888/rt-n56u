# trunk/user/httpd/cgi-bin/ping_test
#!/bin/sh
TARGET=$(echo "$QUERY_STRING" | sed 's/.*target=$[^&]*$.*/\1/')

# 输入验证（仅允许字母数字和. -）
if ! echo "$TARGET" | grep -qE '^[a-zA-Z0-9.-]+$'; then
    echo "Content-type: text/plain"
    echo ""
    echo "非法输入！"
    exit 1
fi

echo "Content-type: text/plain"
echo ""
ping -c 4 "$TARGET" 2>&1 | sed -e 's/ packets / 数据包/g' \
    -e 's/ transmitted/已发送/g' \
    -e 's/ received/已接收/g' \
    -e 's/time /时间/g' \
    -e 's/min\/avg\/max\/mdev = //g'